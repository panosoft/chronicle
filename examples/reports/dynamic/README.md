# Dynamic Report

This Report Module exports a Definition function and uses a dynamic set of data that is refreshed each time the Report is run.

This is an example of a typical Report.

# Installation

To install and run this report, run the following in Terminal:

```sh
npm install
npm test
```

After running the above commands, the report pdf should open in a new window of your systems preferred pdf viewer. If it does not open automatically, the pdf can be found within the [`test/`](test/) directory after running `npm test`.

# Description

This Report Module exports a yieldable Definition function that returns a Definition object ([`lib/index.js`](lib/index.js)). Since this function is yieldable, we can perform asynchronous operations within it. As we'll see later, this allows us to inline our report template file asynchronously.

The Definition object returned by this function contains four properties that define the Report: `data`, `template`, `helpers`, and `partials`. Lets walk through each of them:

- `data` - This is a yieldable function that is called with the report `parameters` supplied at runtime. It dynamically fetches data from an external api, processes it, and returns a result that is used as the report templates context. This function takes two optional parameters: `sort` allows the user to determine how popularity should be determined (i.e. most stars or forks) and `results` allows the user to determine how many repositories should be included in the list (i.e. top 20, 100, etc.).

- `helpers` - This is an object the defines a single helper that can be used in the report template: `formatDate`. This helper leverages the [moment.js](http://momentjs.com/) library to make date formatting within the template easy. This is used in the footer of the report template.

- `partials` - This is an object that define a few partials that can be used within the report template: `page` and `pages`. The former returns a span containing the current page number and the latter returns a span containing the total number of pages in the report. This is used in the footer of the report template.

- `template` -
  This is a string that defines the template to use when pressing this report. The context for the template will be the result of the `data` function above and the helpers and partials defined above can be used within this template.

  Note that in this case, we load the template from a separate file ([`lib/template.hbs`](lib/template.hbs)) and that that file references numerous other files (linked less stylesheets that import other css stylesheets, images, fonts, etc.).

  As a result, we use the [`inline-html`](https://github.com/panosoft/inline-html) library to load the template and its references as a single string. This library reads the template file, compiles the referenced LESS stylesheets, embeds all of the referenced local assets within the template, and finally returns the resulting file contents as a string. And, thanks to our yieldable Definition function, all of this inlining is done asynchronously.

The test script for this Report Module ([`test/index.js`](test/index.js)) runs the Report by supplying Chronicle Press with a direct reference to the Report Definition function itself (i.e. not a path to the module entry or to the bundled module file). The HTML generated by the Press is then passed to PrinceXML for visual rendering and finally the HTML and PDF are saved to the local filesystem in the [`test`](test/) directory.
